!function(){"use strict";const e=e=>"string"==typeof e?document.querySelector(e):e(),t=(t,s)=>{const i="string"==typeof t?document.createElement(t):t;for(const t in s){const n=s[t];if("inside"===t)n.append(i);else if("dest"===t)e(n[0]).insertAdjacentElement(n[1],i);else if("around"===t){const e=n;e.parentNode.insertBefore(i,e),i.append(e),null!=e.getAttribute("autofocus")&&e.focus()}else t in i?i[t]=n:i.setAttribute(t,n)}return i},s=e=>e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement?e.value:e.innerHTML,i=(e,t)=>(e=String(e).toLowerCase(),t?e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").normalize("NFC"):e),n=(e,t,s)=>t?t(e):e.length>=s,r=(e,s)=>t("mark",{innerHTML:e,..."string"==typeof s&&{class:s}}).outerHTML;var o=(e,t)=>{t.input.dispatchEvent(new CustomEvent(e,{bubbles:!0,detail:t.feedback,cancelable:!0}))},a=(e,t,s)=>{const{mode:n,diacritics:o,highlight:a}=s||{},l=i(t,o);if(t=String(t),e=i(e,o),"loose"===n){const s=(e=e.replace(/ /g,"")).length;let i=0;const n=Array.from(t).map(((t,n)=>(i<s&&l[n]===e[i]&&(t=a?r(t,a):t,i++),t))).join("");if(i===s)return n}else{let s=l.indexOf(e);if(~s)return e=t.substring(s,s+e.length),s=a?t.replace(e,r(e,a)):t,s}};const l=async(e,t)=>{const{data:s}=e;s.cache&&s.store||(e.feedback=s.store="function"==typeof s.src?await s.src(t):s.src,o("response",e))},c=(e,t)=>{const{data:s,searchEngine:i}=t;let n=[];s.store.forEach(((r,o)=>{const l=s=>{const o=s?r[s]:r,l="function"==typeof i?i(e,o):a(e,o,{mode:i,diacritics:t.diacritics,highlight:t.resultItem.highlight});if(!l)return;let c={match:l,value:r};s&&(c.key=s),n.push(c)};if(s.keys)for(const e of s.keys)l(e);else l()})),s.filter&&(n=s.filter(n));const r=n.slice(0,t.resultsList.maxResults);t.feedback={query:e,matches:n,results:r},o("results",t)},u="aria-expanded",d="aria-activedescendant",p="aria-selected",h=(e,t)=>{e.feedback.selection={index:t,...e.feedback.results[t]}},f=e=>{const{resultsList:s,list:i,resultItem:n,feedback:r}=e,{matches:o,results:a}=r;if(e.cursor=-1,i.innerHTML="",o.length||s.noResults){const o=new DocumentFragment;a.forEach(((e,s)=>{const i=t(n.tag,{id:`${n.id}_${s}`,role:"option",innerHTML:e.match,inside:o,...n.class&&{class:n.class}});n.element&&n.element(i,e)})),i.append(o),s.element&&s.element(i,r),m(e)}else g(e)},m=e=>{e.isOpen||((e.wrapper||e.input).setAttribute(u,!0),e.list.removeAttribute("hidden"),e.isOpen=!0,o("open",e))},g=e=>{e.isOpen&&((e.wrapper||e.input).setAttribute(u,!1),e.input.setAttribute(d,""),e.list.setAttribute("hidden",""),e.isOpen=!1,o("close",e))},b=(e,t)=>{const{resultItem:s}=t,i=t.list.getElementsByTagName(s.tag),n=!!s.selected&&s.selected.split(" ");if(t.isOpen&&i.length){const s=t.cursor;e>=i.length&&(e=0),e<0&&(e=i.length-1),t.cursor=e,s>-1&&(i[s].removeAttribute(p),n&&i[s].classList.remove(...n)),i[e].setAttribute(p,!0),n&&i[e].classList.add(...n),t.input.setAttribute(d,i[t.cursor].id),t.list.scrollTop=i[e].offsetTop-t.list.clientHeight+i[e].clientHeight+5,t.feedback.cursor=t.cursor,h(t,e),o("navigate",t)}},v=e=>{b(e.cursor+1,e)},y=e=>{b(e.cursor-1,e)},L=(e,t,s)=>{(s=s>=0?s:e.cursor)<0||(e.feedback.event=t,h(e,s),o("selection",e),g(e))};async function k(e,t){let i=t||s(e.input);i=e.query?e.query(i):i;if(n(i,e.trigger,e.threshold)){if(await l(e,i),e.feedback instanceof Error)return;c(i,e),e.resultsList&&f(e)}else g(e)}const w=(e,t)=>{for(const s in e)for(const i in e[s])t(s,i)},E=e=>{const{events:t}=e,s=((e,t)=>{let s;return()=>{clearTimeout(s),s=setTimeout((()=>e()),t)}})((()=>k(e)),e.debounce),i=e.events={input:{...t&&t.input},...e.resultsList&&{list:t?{...t.list}:{}}},n={input:{input(){s()},keydown(t){((e,t)=>{switch(e.keyCode){case 40:case 38:e.preventDefault(),40===e.keyCode?v(t):y(t);break;case 13:t.submit||e.preventDefault(),t.cursor>=0&&L(t,e);break;case 9:t.resultsList.tabSelect&&t.cursor>=0&&L(t,e);break;case 27:t.input.value="",g(t)}})(t,e)},blur(){g(e)}},list:{mousedown(e){e.preventDefault()},click(t){((e,t)=>{const s=t.resultItem.tag.toUpperCase(),i=Array.from(t.list.querySelectorAll(s)),n=e.target.closest(s);n&&n.nodeName===s&&L(t,e,i.indexOf(n))})(t,e)}}};w(n,((t,s)=>{(e.resultsList||"input"===s)&&(i[t][s]||(i[t][s]=n[t][s]))})),w(i,((t,s)=>{e[t].addEventListener(s,i[t][s])}))},x=e=>{w(e.events,((t,s)=>{e[t].removeEventListener(s,e.events[t][s])}))};async function A(e){const{placeHolder:s,resultsList:i}=e,n={role:"combobox","aria-owns":i.id,"aria-haspopup":!0,"aria-expanded":!1};t(e.input,{"aria-controls":i.id,"aria-autocomplete":"both",...s&&{placeholder:s},...!e.wrapper&&{...n}}),e.wrapper&&(e.wrapper=t("div",{around:e.input,class:e.name+"_wrapper",...n})),i&&(e.list=t(i.tag,{dest:[i.destination,i.position],id:i.id,role:"listbox",hidden:"hidden",...i.class&&{class:i.class}})),E(e),e.data.cache&&await l(e),o("init",e)}function T(e){const{prototype:t}=e;t.init=function(){A(this)},t.start=function(e){k(this,e)},t.unInit=function(){if(this.wrapper){const e=this.wrapper.parentNode;e.insertBefore(this.input,this.wrapper),e.removeChild(this.wrapper)}x(this)},t.open=function(){m(this)},t.close=function(){g(this)},t.goTo=function(e){b(e,this)},t.next=function(){v(this)},t.previous=function(){y(this)},t.select=function(e){L(this,null,e)},t.search=function(e,t,s){return a(e,t,s)}}function _(t){this.options=t,this.id=_.instances=(_.instances||0)+1,this.name="autoComplete",this.wrapper=1,this.threshold=1,this.debounce=0,this.resultsList={position:"afterend",tag:"ul",maxResults:5},this.resultItem={tag:"li"},(t=>{const{name:s,options:i,resultsList:n,resultItem:r}=t;for(const e in i)if("object"==typeof i[e]){t[e]||(t[e]={});for(const s in i[e])t[e][s]=i[e][s]}else t[e]=i[e];t.selector=t.selector||"#"+s,n.destination=n.destination||t.selector,n.id=n.id||s+"_list_"+t.id,r.id=r.id||s+"_result",t.input=e(t.selector)})(this),T.call(this,_),A(this)}class C{static init(){console.log("init");setTimeout((()=>{let e=document.querySelectorAll("input[data-autocompletejs='1']");0!==e.length&&e.forEach((e=>{let t=JSON.parse(e.dataset.autocompletejsOptions);t.selector||(void 0===t.selector&&void 0!==e.id?t.selector="#"+e.id:t.selector=()=>e),e.setAttribute("autocomplete","off"),C.configureData(t),t.threshold=t.threshold-1;let s=t.resultsList&&t.resultsList.maxResults?t.resultsList.maxResults:t.maxResults??5;delete t.maxResults,t.resultsList={tabSelection:!0,id:"autocomplete_"+e.id,class:"autocomplete_results_container",position:"afterend",maxResults:s},t.resultItem={tag:"li",id:"autoComplete_result_"+e.id,class:"autoComplete_result",element:(e,t)=>{"object"==typeof t.match?e.innerHTML=Object.values(t.match)[0]:e.innerHTML=t.match,document.dispatchEvent(new CustomEvent("huh.autocompletejs.adjust_result_item",{bubbles:!0,cancelable:!0,detail:{source:e,data:t}}))},highlight:t.highlight},"none"===t.searchEngine&&(t.searchEngine=(e,t)=>t);let i=new _(t);e.addEventListener("focus",(e=>{i.start()})),e.addEventListener("blur",(e=>{i.close()})),e.addEventListener("selection",(s=>{let i=s.detail.selection.value;t.data.keys&&(i=s.detail.selection.value[t.data.keys[0]]),e.value=i,document.dispatchEvent(new CustomEvent("huh.autocompletejs.onselection",{bubbles:!0,cancelable:!0,detail:{field:e,item:s.detail}}))}))}))}),100)}static configureData(e){let t=e.data;if(!("src"in t)&&"url"in t){let e=t.url;t.src=async t=>{try{const s=await fetch(e.replace("{query}",t));return await s.json()}catch(e){return e}},delete t.url}"key"in t&&!("keys"in t)&&(console.log("Using data.key is deprecated. Please use data.keys instead."),t.keys=t.key),e.data=t}}document.addEventListener("DOMContentLoaded",C.init),document.addEventListener("formhybrid_ajax_complete",C.init),document.addEventListener("ajaxComplete",C.init)}();